var ratingSettings=new Array();function ratingInit(b,c,d,f,g,h){ratingSettings[b]=new Array();ratingSettings[b]['data']=eval('('+c+')');ratingSettings[b]['options']=eval('('+f+')');ratingSettings[b]['config']=eval('('+d+')');ratingSettings[b]['enabled']=g;ratingSettings[b]['webroot']=h;for(var i=1;i<=ratingSettings[b]['data']['%MAX%'];i++){$('#'+b+'_'+i).bind('mouseenter',{i:i},function(e){var a=e.relatedTarget||e.toElement;if(a&&a.id!=b+'_'+e.data.i){if(ratingSettings[b]['enabled']){ratingSet(b,e.data.i)}if(ratingSettings[b]['config']['showMouseOverMessages']){ratingMessages(b,e.data.i)}}});if(ratingSettings[b]['enabled']){$('#'+b+'_'+i).bind('click',{i:i},function(e){ratingSave(b,e.data.i)})}}$('#'+b).bind('mouseleave',function(e){ratingReset(b)});$('#'+b+'_text').bind('mouseenter',function(e){ratingReset(b);if(ratingSettings[b]['config']['showMouseOverMessages']){ratingMessages(b)}});ratingReset(b)}function ratingSet(a,b){var c=ratingSettings[a]['config']['starEmptyImageLocation'];for(i=1;i<=ratingSettings[a]['data']['%MAX%'];i++){if(i<=Math.floor(b)){c=ratingSettings[a]['config']['starFullImageLocation']}else if(i==Math.floor(b)+1&&b.toString().match(/[0-9]\.[5-9]/)){c=ratingSettings[a]['config']['starHalfImageLocation']}else{c=ratingSettings[a]['config']['starEmptyImageLocation']}$('#'+a+'_'+i).attr({'src':ratingSettings[a]['webroot']+c});if(ratingSettings[a]['config']['showUserRatingMark']&&i<=ratingSettings[a]['data']['%RATING%']){$('#'+a+'_'+i).attr({'class':'rating-user'})}else{$('#'+a+'_'+i).attr({'class':'rating'})}if(!ratingSettings[a]['enabled']&&!$('#'+a+'_'+i).attr('class').match(/-disabled/)){$('#'+a+'_'+i).attr({'class':$('#'+a+'_'+i).attr('class')+'-disabled'})}}}function ratingReset(a){if(ratingSettings[a]['config']['showUserRatingStars']){ratingSet(a,ratingSettings[a]['data']['%RATING%'])}else{ratingSet(a,ratingSettings[a]['data']['%AVG%'])}$('#'+a+'_text').html(ratingSettings[a]['config']['statusText'])}function ratingSave(b,c){data=b.split('_');if(ratingSettings[b]['enabled']){$.ajax({url:ratingSettings[b]['webroot']+'rating/ratings/save/'+data[0]+'/'+data[3]+'/'+c+'?'+Math.floor(Math.random()*999999),async:true,data:ratingSettings[b]['options'],error:function(){},beforeSend:function(){},complete:function(a){$('#'+b).html(a.responseText)}})}}function ratingMessages(a,b){if(ratingSettings[a]['enabled']&&b>0){if(b==ratingSettings[a]['data']['%RATING%']&&ratingSettings[a]['config']['allowDelete']&&ratingSettings[a]['config']['mouseOverMessages']['delete']){$('#'+a+'_text').html(ratingSettings[a]['config']['mouseOverMessages']['delete'])}else if(ratingSettings[a]['config']['mouseOverMessages'][b]){$('#'+a+'_text').html(ratingSettings[a]['config']['mouseOverMessages'][b])}}else if(!ratingSettings[a]['enabled']&&!ratingSettings[a]['config']['disable']&&ratingSettings[a]['data']['%RATING%']==0&&ratingSettings[a]['config']['mouseOverMessages']['login']){$('#'+a+'_text').html(ratingSettings[a]['config']['mouseOverMessages']['login'])}else if(!ratingSettings[a]['enabled']&&ratingSettings[a]['data']['%RATING%']>0&&ratingSettings[a]['config']['mouseOverMessages']['rated']){$('#'+a+'_text').html(ratingSettings[a]['config']['mouseOverMessages']['rated'])}else{$('#'+a+'_text').html(ratingSettings[a]['config']['statusText'])}}