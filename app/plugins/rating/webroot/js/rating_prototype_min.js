var ratingSettings=new Array();function ratingInit(c,d,f,g,h,j){ratingSettings[c]=new Array();ratingSettings[c]['data']=eval('('+d+')');ratingSettings[c]['options']=eval('('+g+')');ratingSettings[c]['config']=eval('('+f+')');ratingSettings[c]['enabled']=h;ratingSettings[c]['webroot']=j;for(var i=1;i<=ratingSettings[c]['data']['%MAX%'];i++){$(c+'_'+i).observe('mouseover',function(e){var a=this.id.match(/[0-9]*$/);var b=e.relatedTarget||e.toElement;if(b&&b.id!=c+'_'+a){if(ratingSettings[c]['enabled']){ratingSet(c,a)}if(ratingSettings[c]['config']['showMouseOverMessages']){ratingMessages(c,a)}}});$(c+'_'+i).observe('click',function(e){var a=this.id.match(/[0-9]*$/);ratingSave(c,a)})}$(c).observe('mouseout',function(e){var a=e.relatedTarget||e.toElement;if(a&&a.parentNode&&a.parentNode.id!=null&&!a.parentNode.id.match(c)){ratingReset(c)}});$(c+'_text').observe('mouseover',function(e){var a=e.relatedTarget||e.toElement;if(a&&a.parentNode&&a.parentNode.id!=null&&!a.parentNode.id.match(c)){ratingReset(c);if(ratingSettings[c]['config']['showMouseOverMessages']){ratingMessages(c)}}});ratingReset(c)}function ratingSet(a,b){var c=ratingSettings[a]['config']['starEmptyImageLocation'];for(i=1;i<=ratingSettings[a]['data']['%MAX%'];i++){if(i<=Math.floor(b)){c=ratingSettings[a]['config']['starFullImageLocation']}else if(i==Math.floor(b)+1&&b.toString().match(/[0-9]\.[5-9]/)){c=ratingSettings[a]['config']['starHalfImageLocation']}else{c=ratingSettings[a]['config']['starEmptyImageLocation']}$(a+'_'+i).src=ratingSettings[a]['webroot']+c;if(ratingSettings[a]['config']['showUserRatingMark']&&i<=ratingSettings[a]['data']['%RATING%']){$(a+'_'+i).className='rating-user'}else{$(a+'_'+i).className='rating'}if(!ratingSettings[a]['enabled']&&!$(a+'_'+i).className.match(/-disabled/)){$(a+'_'+i).className+='-disabled'}}}function ratingReset(a){if(ratingSettings[a]['config']['showUserRatingStars']){ratingSet(a,ratingSettings[a]['data']['%RATING%'])}else{ratingSet(a,ratingSettings[a]['data']['%AVG%'])}$(a+'_text').update(ratingSettings[a]['config']['statusText'])}function ratingSave(c,d){data=c.split('_');if(ratingSettings[c]['enabled']){new Ajax.Updater(c,ratingSettings[c]['webroot']+'rating/ratings/save/'+data[0]+'/'+data[3]+'/'+d+'?'+Math.floor(Math.random()*999999),{asynchronous:true,evalScripts:true,method:'get',parameters:ratingSettings[c]['options'],onFailure:function error(){},onLoading:function(a){},onComplete:function(a,b){}})}}function ratingMessages(a,b){if(ratingSettings[a]['enabled']&&b>0){if(b==ratingSettings[a]['data']['%RATING%']&&ratingSettings[a]['config']['allowDelete']&&ratingSettings[a]['config']['mouseOverMessages']['delete']){$(a+'_text').update(ratingSettings[a]['config']['mouseOverMessages']['delete'])}else if(ratingSettings[a]['config']['mouseOverMessages'][b]){$(a+'_text').update(ratingSettings[a]['config']['mouseOverMessages'][b])}}else if(!ratingSettings[a]['enabled']&&!ratingSettings[a]['config']['disable']&&ratingSettings[a]['data']['%RATING%']==0&&ratingSettings[a]['config']['mouseOverMessages']['login']){$(a+'_text').update(ratingSettings[a]['config']['mouseOverMessages']['login'])}else if(!ratingSettings[a]['enabled']&&ratingSettings[a]['data']['%RATING%']>0&&ratingSettings[a]['config']['mouseOverMessages']['rated']){$(a+'_text').update(ratingSettings[a]['config']['mouseOverMessages']['rated'])}else{$(a+'_text').update(ratingSettings[a]['config']['statusText'])}}