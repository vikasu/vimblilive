var allthemes={};displaychange=0;jQuery(function(d){d(function(){if(d("#themes-reload").length>0){wysijaAJAX.task="refresh_themes";jQuery.ajax({type:"POST",url:wysijaAJAX.ajaxurl,data:wysijaAJAX,success:function(h){window.parent.jQuery("#wj_themes_list").html(h.result.themes);window.parent.handleSwitchTheme();window.parent.handleRemoveTheme()},error:function(h){},dataType:"json"})}});d(document).on("click",".install",function(){c(d(this).data("id"),d(this).hasClass("installed"));return false});function c(h,i){wysijaAJAX.task="install_theme";var j=allthemes[h];wysijaAJAX.theme_id=j.id;wysijaAJAX.theme_key=j.key;wysijaAJAX.premium=parseInt(j.is_premium);wysijaAJAX.theme_name=j.name;if(i&&!confirm(wysijatrans.reinstallwarning.replace("%1$s",j.key))){return false}wysijaAJAX._wpnonce=d("#wysijax").val();jQuery("#overlay").show();jQuery.ajax({type:"POST",url:wysijaAJAX.ajaxurl,data:wysijaAJAX,success:function(k){a("search-view");jQuery("#overlay").hide();jQuery.WYSIJA_HANDLE_RESPONSE(k);window.parent.jQuery("#wj_themes_list").html(k.result.themes);window.parent.handleSwitchTheme();window.parent.handleRemoveTheme()},error:function(k){jQuery.WYSIJA_HANDLE_RESPONSE(k);jQuery("#overlay").hide();a("search-view")},dataType:"json"})}function a(h){d(".panel").hide();d("#"+h).show();window.parent.WysijaPopup.setDimensions.defer()}d(document).on("click",".infos",function(){var p=allthemes[d(this).data("id")],n="",j=wysijatrans.install;if(p===undefined){return}if(d.inArray(p.key,wysijatrans.installedthemes)!==-1){n=" installed";j=wysijatrans.reinstall}if(parseInt(p.is_premium)===1){n+=" premium";if(parseInt(wysijatrans.ispremium)!==1){j=wysijatrans.premiumonly}}var k='<div class="theme-screenshot"><img src="'+p.screenshot+'" alt="'+p.name+'" /></div>';var q='<img src="'+e(p.author_email,80)+'" class="avatar" width="80px"/>';var h=q+"<h2>"+p.name+'</h2><p><input type="button" value="'+j+'" data-id="'+p.id+'" class="button-primary install'+n+'" /></p>';var l='<div class="stars"><div id="average-vote" class="star-rating" style="width:'+((p.rating*95)/5)+'px;"></div></div>';var s='<div class="stars my-rating clearfix" data-theme="'+parseInt(p.id)+'">';for(var o=0;o<5;o++){if(parseInt(p.user_rating)>o){s+='<a href="javascript:;" class="active" data-value="'+(o+1)+'"></a>'}else{s+='<a href="javascript:;" data-value="'+(o+1)+'"></a>'}}s+="</div>";h+='<div class="paragraph"><strong>'+wysijatrans.stars.replace("%1$s","</strong> "+wysijatrans.totalvotes.replace("%1$s",'<span id="total-votes">'+p.votes+"</span>")+l)+"</div>";h+='<div class="paragraph"><strong>'+wysijatrans.starsyr.replace("%1$s","</strong>"+s)+"</div>";h+="<p><strong>"+wysijatrans.downloads.replace("%1$s","</strong>"+p.downloads_zip)+"</p>";h+="<p><strong>"+wysijatrans.lastupdated.replace("%1$s","</strong>"+p.updated_at)+"</p>";h+="<p>"+wysijatrans.viewallthemes.replace("%1$s",'<a href="javascript:;" class="author-id-filter" id="author-id-filter'+p.author_id+'">'+p.author_name+"</a>")+"</p>";var m="";if(p.has_psd==1){m='<p><a href="http://api.wysija.com/download/psd/'+p.id+"?domain="+wysijatrans.domainname+'" class="downpsd">'+wysijatrans.downloadpsd+"</a></p>";if(parseInt(p.is_premium)===1&&parseInt(wysijatrans.ispremium)!==1){m="<p><strong>"+wysijatrans.premiumfiles+"</strong></p>"}}h+=m;h+='<p><a href="'+p.author_url+'" target="_blank">'+wysijatrans.viewauthorsite+"</a></p>";var r='<div class="wrap actions"><a class="button-secondary2 theme-view-back" href="javascript:;">'+wysijatrans.viewback+'</a></div><div class="theme-infos clearfix"><div class="preview">'+k+'</div><div class="infos">'+h+"</div></div>";d("#theme-view").html(r);a("theme-view");window.parent.WysijaPopup.setDimensions();return false});d(document).on("click",".theme-view-back",function(){a("search-view");return false});d("#gallery-form").submit(function(){g();return false});d(document).on("click",".my-rating a",function(){var k=parseInt(d(this).data("value"));for(var h=0;h<5;h++){if(h<k){d(d(".my-rating a")[h]).addClass("active")}else{d(d(".my-rating a")[h]).removeClass("active")}}var j=parseInt(d(this).parent().data("theme"));d.getJSON("http://api.wysija.com/theme/rate/"+j+"?rating="+k+"&domain="+wysijatrans.domainname+"&callback=?",function(i){if(i){d("#average-vote").css("width",parseInt((i.rating*95)/5));d("#total-votes").html(i.votes);allthemes[j]["votes"]=i.votes;allthemes[j]["user_rating"]=k;allthemes[j]["rating"]=i.rating}});return false});d(document).on("hover",".my-rating a",function(){var j=parseInt(d(this).data("value"));d(".my-rating a").removeClass("on").removeClass("off");for(var h=0;h<5;h++){if(h<j){d(d(".my-rating a")[h]).addClass("on")}else{d(d(".my-rating a")[h]).addClass("off")}}});d(document).on("mouseout",".my-rating a",function(){d(".my-rating a").removeClass("on").removeClass("off")});function g(){b(0)}function f(i,h){alert("Request error not JSON:"+i.responseText);jQuery.WYSIJA_HANDLE_RESPONSE(response)}function b(k,i,j){var h='<li><img title="Loading" alt="loading" src="../wp-content/plugins/wysija-newsletters/img/wpspin_light.gif" /></li>';d("#themes-list").html(h);var l="";if(i){l+="&author_id="+i}if(j){l+="&tag_id="+j}d.getJSON("http://api.wysija.com/theme/search?offset="+k+"&limit=21&domain="+wysijatrans.domainname+l+"&callback=?",function(n){if(n){if(n.paginator.pageCount>1){var p=[];d.each(n.paginator.pagesInRange,function(q,r){if(r==n.paginator.current){p.push("<span>"+r+"</span>")}else{p.push('<a href="javascript:;" data-page="'+(r-1)+'">'+r+"</a>")}});d("#wj_paginator").html(p.join("\n"))}var m="",o="";jQuery.each(n.themes,function(r,s){allthemes[s.id]=s;o="";if((r+1)%7===0){o+=" last"}var q=wysijatrans.install;if(jQuery.inArray(s.key,wysijatrans.installedthemes)!==-1){o+=" installed";q=wysijatrans.reinstall}if(parseInt(s.is_premium)===1){o+=" premium";if(parseInt(wysijatrans.ispremium)!==1){q=wysijatrans.premiumonly}}m+='<li class="theme'+o+'">';m+='<div class="thumbnail">';m+="<h3>"+s.name.replace(/\s?\-\s?/,"<br />")+"</h3>";m+='<img src="'+s.thumbnail+'" alt="'+s.name+'" title="'+s.name+'" />';m+='<a class="button-primary install'+o+'" href="javascript:;" data-id="'+s.id+'">'+q+"</a>";m+="</div>";m+='<a class="infos" href="javascript:;" data-id="'+s.id+'">'+wysijatrans.viewinfos+"</a>";m+="</li>"})}else{var m="<div>";m+="<strong>"+wysijatrans.errorconnecting+"</strong>";m+="</div>"}d("#themes-list").html(m)})}d("#sub-theme-box").click(function(){a("theme-upload")});d(document).on("click","#wj_paginator a",function(){b(d(this).data("page"));return false});d(document).on("click","a.author-id-filter",function(){d("#filter-selection").html('<a href="javascript:;" class="button-secondary2 filter-none">'+wysijatrans.showallthemes+"</a>");b(0,d(this).attr("id").replace("author-id-filter",""));a("search-view");return false});d(document).on("click","a.filter-none",function(){d("#filter-selection").html("");b(0);return false});b(0);function e(h,i){if(h==null){return"http://www.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s="+i}var j=function(av){function ag(l,m){return(l<<m)|(l>>>(32-m))}function ah(p,m){var n,r,q,o,l;q=(p&2147483648);o=(m&2147483648);n=(p&1073741824);r=(m&1073741824);l=(p&1073741823)+(m&1073741823);if(n&r){return(l^2147483648^q^o)}if(n|r){if(l&1073741824){return(l^3221225472^q^o)}else{return(l^1073741824^q^o)}}else{return(l^q^o)}}function aw(n,m,l){return(n&m)|((~n)&l)}function ax(n,m,l){return(n&l)|(m&(~l))}function ay(n,m,l){return(n^m^l)}function aA(n,m,l){return(m^(n|(~l)))}function at(o,p,r,q,l,n,m){o=ah(o,ah(ah(aw(p,r,q),l),m));return ah(ag(o,n),p)}function aH(o,p,r,q,l,n,m){o=ah(o,ah(ah(ax(p,r,q),l),m));return ah(ag(o,n),p)}function ak(o,p,r,q,l,n,m){o=ah(o,ah(ah(ay(p,r,q),l),m));return ah(ag(o,n),p)}function au(o,p,r,q,l,n,m){o=ah(o,ah(ah(aA(p,r,q),l),m));return ah(ag(o,n),p)}function aI(s){var m;var t=s.length;var p=t+8;var n=(p-(p%64))/64;var q=(n+1)*16;var l=Array(q-1);var o=0;var r=0;while(r<t){m=(r-(r%4))/4;o=(r%4)*8;l[m]=(l[m]|(s.charCodeAt(r)<<o));r++}m=(r-(r%4))/4;o=(r%4)*8;l[m]=l[m]|(128<<o);l[q-2]=t<<3;l[q-1]=t>>>29;return l}function am(l){var m="",o="",n,p;for(p=0;p<=3;p++){n=(l>>>(p*8))&255;o="0"+n.toString(16);m=m+o.substr(o.length-2,2)}return m}function ai(m){m=m.replace(/rn/g,"n");var o="";for(var n=0;n<m.length;n++){var l=m.charCodeAt(n);if(l<128){o+=String.fromCharCode(l)}else{if((l>127)&&(l<2048)){o+=String.fromCharCode((l>>6)|192);o+=String.fromCharCode((l&63)|128)}else{o+=String.fromCharCode((l>>12)|224);o+=String.fromCharCode(((l>>6)&63)|128);o+=String.fromCharCode((l&63)|128)}}}return o}var al=Array();var ac,aF,aj,ar,aG,k,x,F,G;var Z=7,ab=12,ae=17,af=22;var an=5,ao=9,ap=14,aq=20;var az=4,aB=11,aC=16,aD=23;var H=6,I=10,aa=15,ad=21;av=ai(av);al=aI(av);k=1732584193;x=4023233417;F=2562383102;G=271733878;for(ac=0;ac<al.length;ac+=16){aF=k;aj=x;ar=F;aG=G;k=at(k,x,F,G,al[ac+0],Z,3614090360);G=at(G,k,x,F,al[ac+1],ab,3905402710);F=at(F,G,k,x,al[ac+2],ae,606105819);x=at(x,F,G,k,al[ac+3],af,3250441966);k=at(k,x,F,G,al[ac+4],Z,4118548399);G=at(G,k,x,F,al[ac+5],ab,1200080426);F=at(F,G,k,x,al[ac+6],ae,2821735955);x=at(x,F,G,k,al[ac+7],af,4249261313);k=at(k,x,F,G,al[ac+8],Z,1770035416);G=at(G,k,x,F,al[ac+9],ab,2336552879);F=at(F,G,k,x,al[ac+10],ae,4294925233);x=at(x,F,G,k,al[ac+11],af,2304563134);k=at(k,x,F,G,al[ac+12],Z,1804603682);G=at(G,k,x,F,al[ac+13],ab,4254626195);F=at(F,G,k,x,al[ac+14],ae,2792965006);x=at(x,F,G,k,al[ac+15],af,1236535329);k=aH(k,x,F,G,al[ac+1],an,4129170786);G=aH(G,k,x,F,al[ac+6],ao,3225465664);F=aH(F,G,k,x,al[ac+11],ap,643717713);x=aH(x,F,G,k,al[ac+0],aq,3921069994);k=aH(k,x,F,G,al[ac+5],an,3593408605);G=aH(G,k,x,F,al[ac+10],ao,38016083);F=aH(F,G,k,x,al[ac+15],ap,3634488961);x=aH(x,F,G,k,al[ac+4],aq,3889429448);k=aH(k,x,F,G,al[ac+9],an,568446438);G=aH(G,k,x,F,al[ac+14],ao,3275163606);F=aH(F,G,k,x,al[ac+3],ap,4107603335);x=aH(x,F,G,k,al[ac+8],aq,1163531501);k=aH(k,x,F,G,al[ac+13],an,2850285829);G=aH(G,k,x,F,al[ac+2],ao,4243563512);F=aH(F,G,k,x,al[ac+7],ap,1735328473);x=aH(x,F,G,k,al[ac+12],aq,2368359562);k=ak(k,x,F,G,al[ac+5],az,4294588738);G=ak(G,k,x,F,al[ac+8],aB,2272392833);F=ak(F,G,k,x,al[ac+11],aC,1839030562);x=ak(x,F,G,k,al[ac+14],aD,4259657740);k=ak(k,x,F,G,al[ac+1],az,2763975236);G=ak(G,k,x,F,al[ac+4],aB,1272893353);F=ak(F,G,k,x,al[ac+7],aC,4139469664);x=ak(x,F,G,k,al[ac+10],aD,3200236656);k=ak(k,x,F,G,al[ac+13],az,681279174);G=ak(G,k,x,F,al[ac+0],aB,3936430074);F=ak(F,G,k,x,al[ac+3],aC,3572445317);x=ak(x,F,G,k,al[ac+6],aD,76029189);k=ak(k,x,F,G,al[ac+9],az,3654602809);G=ak(G,k,x,F,al[ac+12],aB,3873151461);F=ak(F,G,k,x,al[ac+15],aC,530742520);x=ak(x,F,G,k,al[ac+2],aD,3299628645);k=au(k,x,F,G,al[ac+0],H,4096336452);G=au(G,k,x,F,al[ac+7],I,1126891415);F=au(F,G,k,x,al[ac+14],aa,2878612391);x=au(x,F,G,k,al[ac+5],ad,4237533241);k=au(k,x,F,G,al[ac+12],H,1700485571);G=au(G,k,x,F,al[ac+3],I,2399980690);F=au(F,G,k,x,al[ac+10],aa,4293915773);x=au(x,F,G,k,al[ac+1],ad,2240044497);k=au(k,x,F,G,al[ac+8],H,1873313359);G=au(G,k,x,F,al[ac+15],I,4264355552);F=au(F,G,k,x,al[ac+6],aa,2734768916);x=au(x,F,G,k,al[ac+13],ad,1309151649);k=au(k,x,F,G,al[ac+4],H,4149444226);G=au(G,k,x,F,al[ac+11],I,3174756917);F=au(F,G,k,x,al[ac+2],aa,718787259);x=au(x,F,G,k,al[ac+9],ad,3951481745);k=ah(k,aF);x=ah(x,aj);F=ah(F,ar);G=ah(G,aG)}var aE=am(k)+am(x)+am(F)+am(G);return aE.toLowerCase()};var i=i||80;return"http://www.gravatar.com/avatar/"+j(h)+".jpg?s="+i}});